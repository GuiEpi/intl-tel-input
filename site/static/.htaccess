# 1. HIGH-PERFORMANCE ERROR RESPONSES
ErrorDocument 403 "Forbidden"
ErrorDocument 404 "Not Found"

# 2. GLOBAL SETTINGS
Options -MultiViews
RewriteEngine On

# 3. THE GATEKEEPER (Asset Protection)
# ------------------------------------------------------------------

# EXEMPTION: Always allow /img/ folder (OG Previews, etc.)
RewriteCond %{REQUEST_URI} !^/img/ [NC]

# ALLOW: Major Search Engines & Utilities (By Referrer)
RewriteCond %{HTTP_REFERER} !^https?://(www\.)?intl-tel-input\.com [NC]
RewriteCond %{HTTP_REFERER} !^https?://(www\.)?google\. [NC]
RewriteCond %{HTTP_REFERER} !^https?://(www\.)?bing\. [NC]
RewriteCond %{HTTP_REFERER} !^https?://(www\.)?duckduckgo\. [NC]
RewriteCond %{HTTP_REFERER} !^https?://(www\.)?yahoo\. [NC]
RewriteCond %{HTTP_REFERER} !^https?://(www\.)?pinterest\. [NC]
RewriteCond %{HTTP_REFERER} !^https?://(www\.)?gtmetrix\.com [NC]
RewriteCond %{HTTP_REFERER} !^https?://(www\.)?pingdom\.com [NC]

# ALLOW: Social Media & Discovery (By User-Agent)
# Catches bots that skip the "Referer" header
RewriteCond %{HTTP_USER_AGENT} !(googlebot|bingbot|duckduckbot|applebot|facebookexternalhit|twitterbot|linkedinbot|discordbot|whatsapp|ia_archiver|pinterest) [NC]

# ALLOW: Direct visits (no referrer)
RewriteCond %{HTTP_REFERER} !^$

# BLOCK: Everyone else
RewriteRule \.(jpe?g|png|gif|webp|ico|svg|css|js|pdf|zip)$ - [F,E=dontlog:1,L,NC]

# ------------------------------------------------------------------

# 4. REMOVE TRAILING SLASH
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)/$ /$1 [L,R=301]

# 5. REMOVE .HTML EXTENSION (External Redirect)
RewriteCond %{THE_REQUEST} /([^.]+)\.html [NC]
RewriteRule ^ /%1 [L,R=301]

# 6. MAP CLEAN URL TO FILE (Internal Rewrite)
RewriteCond %{ENV:REDIRECT_STATUS} ^$
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}\.html -f
RewriteRule ^(.*)$ $1.html [L]